<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>FreshChat Conditional Widget</title>
</head>
<body>
  <h1>Welcome to Our Website</h1>
  <p>This page will show the FreshChat widget only when an agent is online.</p>

<script>
  const freshchatToken = "75e2c316-0fb9-4461-bcc9-9a81075e056c";

  fetch(`https://wchat.freshchat.com/_api/public/availability?token=${freshchatToken}`)
    .then(response => response.json())
    .then(data => {
      if (data.availableAgents > 0) {
        // Agents are online, load the widget
        window.fcSettings = {
          token: freshchatToken,
          host: "https://wchat.freshchat.com"
        };

        (function(d, id){
          if (d.getElementById(id)) return;
          var fcJS = d.createElement("script");
          fcJS.id = id;
          fcJS.async = true;
          fcJS.src = "https://wchat.freshchat.com/js/widget.js";
          d.head.appendChild(fcJS);
        })(document, "freshchat-js-sdk");
      } else {
        console.log("No agents online â€“ widget not loaded.");
      }
    })
    .catch(err => {
      console.error("Error checking agent availability", err);
    });
</script>

</body>
</html>
